(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"0aec":function(e,t,n){"use strict";n.r(t);var a=n("2b4c"),i=n("8522");for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);n("7417");var s,r=n("f0c5"),u=Object(r["a"])(i["default"],a["b"],a["c"],!1,null,"cad64a64",null,!1,a["a"],s);t["default"]=u.exports},"26ed":function(e,t,n){},"2b4c":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return a}));var a={uNoticeBar:function(){return n.e("node-modules/uview-ui/components/u-notice-bar/u-notice-bar").then(n.bind(null,"f4ce"))},lvSelect:function(){return n.e("components/lv-select/lv-select").then(n.bind(null,"5556"))},uSelect:function(){return n.e("node-modules/uview-ui/components/u-select/u-select").then(n.bind(null,"1a15"))},uPopup:function(){return n.e("node-modules/uview-ui/components/u-popup/u-popup").then(n.bind(null,"8e0b"))}},i=function(){var e=this,t=e.$createElement;e._self._c},o=[]},6015:function(e,t,n){"use strict";(function(e){n("9f4d");a(n("66fd"));var t=a(n("0aec"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},7417:function(e,t,n){"use strict";var a=n("26ed"),i=n.n(a);i.a},8522:function(e,t,n){"use strict";n.r(t);var a=n("de0b"),i=n.n(a);for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);t["default"]=i.a},de0b:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(n("a34a")),i=(o(n("2434")),n("e7ad"));function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t,n,a,i,o,s){try{var r=e[o](s),u=r.value}catch(d){return void n(d)}r.done?t(u):Promise.resolve(u).then(a,i)}function r(e){return function(){var t=this,n=arguments;return new Promise((function(a,i){var o=e.apply(t,n);function r(e){s(o,a,i,r,u,"next",e)}function u(e){s(o,a,i,r,u,"throw",e)}r(void 0)}))}}var u=function(){n.e("components/lv-select/lv-select").then(function(){return resolve(n("5556"))}.bind(null,n)).catch(n.oe)},d={components:{lvSelect:u},data:function(){return{avatar:"/static/icon/me.png",nodeDetail:{},showNode:!1,nodeList:[],selectType:"",markers:[{},{},{}],poisdatas:[{},{},{}],title:"map",longitude:113.445775,latitude:23.072598,allData:{},mapData:[],iconData:{},msgList:[],isWarning:!1,showRight:!1,showLeft:!1,showInfor:!1,mapInfo:[],mapKey:"2551140140c18eb5f8e656c64ce3280f",scale:16,loading:!1,showValue:"name",searchValue:"",infoList:[],video_node_list:[],resources_node_list:[],environment_node_list:[],videoInfo:{}}},onLoad:function(){var t=this;e.getLocation({type:"gcj02",success:function(e){t.longitude=e.longitude,t.latitude=e.latitude}}),this.getMsg(),this.getMapData(),this.mapCtx=wx.createMapContext("mapId"),this.mapCtx.on("markerClusterClick",(function(e){console.log("markerClusterClick",e)}))},onShow:function(){e.getStorageSync("avatar")&&(this.avatar=e.getStorageSync("avatar"))},methods:{showType:function(e){this.selectType=e,this.mapData="摄像头"===e?this.allData.video_node_list:"水质检测"===e?this.allData.resources_node_list:"水环境监测"===e?this.allData.environment_node_list:this.allData.node_list,this.initMap(e)},initMap:function(e){this.mapCtx.addMarkers({clear:!0,markers:[]});var t=[],n=this.mapData;"摄像头"===e?n.forEach((function(e,a){var i={id:n[a].id,latitude:n[a].latitude,longitude:n[a].longitude,iconPath:"/static/icon/w1.png",width:40,height:49,joinCluster:!0};t.push(i)})):"水质检测"===e?n.forEach((function(e,a){var i={id:n[a].id,latitude:n[a].latitude,longitude:n[a].longitude,iconPath:"/static/icon/w2.png",width:40,height:49,joinCluster:!0};t.push(i)})):"水环境监测"===e?n.forEach((function(e,a){var i={id:n[a].id,latitude:n[a].latitude,longitude:n[a].longitude,iconPath:"/static/icon/w3.png",width:40,height:49,joinCluster:!0};t.push(i)})):n.forEach((function(e,a){var i={id:n[a].id,latitude:n[a].latitude,longitude:n[a].longitude,joinCluster:!0};1===n[a].type?(i.iconPath="/static/icon/w1.png",i.width=30,i.height=30):2===n[a].type?(i.iconPath="/static/icon/w2.png",i.width=30,i.height=30):3===n[a].type?(i.iconPath="/static/icon/w3.png",i.width=30,i.height=30):4===n[a].type?(i.iconPath="/static/icon/w4.png",i.width=60,i.height=30):5===n[a].type?(i.iconPath="/static/icon/w5.png",i.width=60,i.height=30):6===n[a].type?(i.iconPath="/static/icon/w6.png",i.width=60,i.height=30):(i.iconPath="/static/icon/w7.png",i.width=90,i.height=30),t.push(i)})),this.mapCtx.addMarkers({markers:t,clear:!1,complete:function(e){console.log("addMarkers",e)}})},markertap:function(e){for(var t=0;t<this.allData.environment_node_list.length;t++)e.detail.markerId==this.allData.environment_node_list[t].id&&(this.nodeDetail.nodeName=this.allData.environment_node_list[t].name,this.getNodeData({id:e.detail.markerId}))},getMapData:function(e){var t=this;return r(a.default.mark((function n(){var o;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,(0,i.getMapData)(e);case 2:o=n.sent,0===o.errno&&(t.allData=o.data,t.mapData=o.data.node_list,t.video_node_list=o.data.video_node_list,t.resources_node_list=o.data.resources_node_list,t.environment_node_list=o.data.environment_node_list,t.mapCenter=t.mapData[0].coordinate.split(","),t.initMap());case 4:case"end":return n.stop()}}),n)})))()},getMsg:function(e){var t=this;return r(a.default.mark((function n(){var o;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,(0,i.getMsg)(e);case 2:o=n.sent,0===o.errno&&(o.data.map((function(e){t.msgList.push(e.content)})),t.msgList.length>0&&(t.isWarning=!0));case 4:case"end":return n.stop()}}),n)})))()},getNodeData:function(e){var t=this;return r(a.default.mark((function n(){var o;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,(0,i.getNodeData)(e);case 2:o=n.sent,0===o.errno?t.$nextTick((function(){t.nodeInfor=o.data,"{}"==JSON.stringify(t.nodeInfor)?t.nodeDetail.device_have=0:(t.nodeDetail.device_have=1,t.resInfo=t.nodeInfor.resources_info,t.envInfo=t.nodeInfor.environment_info,t.videoInfo=t.nodeInfor.video_info,t.nodeDetail.temperature=t.resInfo.temperature,t.nodeDetail.temperature_status=t.resInfo.temperature_status,t.nodeDetail.chrominance=t.resInfo.chrominance,t.nodeDetail.chrominance_status=t.resInfo.chrominance_status,t.nodeDetail.turbidity=t.resInfo.turbidity,t.nodeDetail.turbidity_status=t.resInfo.turbidity_status,t.nodeDetail.TOC=t.resInfo.TOC,t.nodeDetail.TOC_status=t.resInfo.TOC_status,t.nodeDetail.COD=t.resInfo.COD,t.nodeDetail.COD_status=t.resInfo.COD_status,t.nodeDetail.PH=t.resInfo.PH,t.nodeDetail.PH_status=t.resInfo.PH_status,t.nodeDetail.EC=t.resInfo.EC,t.nodeDetail.EC_status=t.resInfo.EC_status,t.nodeDetail.suspended=t.resInfo.suspended,t.nodeDetail.suspended_status=t.resInfo.suspended_status,t.nodeDetail.dissolved_oxygen=t.resInfo.dissolved_oxygen,t.nodeDetail.dissolved_oxygen_status=t.resInfo.dissolved_oxygen_status,t.nodeDetail.cadmium_ion=t.resInfo.cadmium_ion,t.nodeDetail.cadmium_ion_status=t.resInfo.cadmium_ion_status,t.nodeDetail.cryanide_ion=t.resInfo.cryanide_ion,t.nodeDetail.cryanide_ion_status=t.resInfo.cryanide_ion_status,t.nodeDetail.lead_ion=t.resInfo.lead_ion,t.nodeDetail.lead_ion_status=t.resInfo.lead_ion_status,t.nodeDetail.chlorophyll=t.resInfo.chlorophyll,t.nodeDetail.chlorophyll_status=t.resInfo.chlorophyll_status,t.nodeDetail.level=t.envInfo.level,t.nodeDetail.level_status=t.envInfo.level_status,t.nodeDetail.rainfall=t.envInfo.rainfall,t.nodeDetail.rainfall_status=t.envInfo.rainfall_status,t.nodeDetail.speed=t.envInfo.speed,t.nodeDetail.speed_status=t.envInfo.speed_status),t.showInfor=!0})):console.log("获取节点详情数据失败");case 4:case"end":return n.stop()}}),n)})))()},tovideo:function(){this.$Router.push({name:"查看视频",params:this.videoInfo})},toMe:function(){e.switchTab({url:"../my/index"})},handleSearch:function(){var e=this;this.loading=!0,setTimeout((function(){e.getNodeList()}),1e3)},getNodeList:function(){var e=this;return r(a.default.mark((function t(){var n,o;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={node_name:e.searchValue},t.next=3,(0,i.getNodeList)(n);case 3:o=t.sent,e.loading=!1,0===o.errno&&(e.infoList=o.data);case 6:case"end":return t.stop()}}),t)})))()},change:function(e){var t=e.coordinate.split(","),n=Number(t[1])-Number(.005),a=Number(t[0])-Number(.005),i=Number(t[1])+Number(.005),o=Number(t[0])+Number(.005);this.mapCtx.includePoints({points:[{latitude:n,longitude:a},{latitude:i,longitude:o}]})}},onNavigationBarButtonTap:function(e){this.showLeft?this.$refs.showLeft.close():this.$refs.showLeft.open()}};t.default=d}).call(this,n("543d")["default"])}},[["6015","common/runtime","common/vendor"]]]);